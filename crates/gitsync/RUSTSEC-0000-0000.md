```toml
[advisory]
id = "RUSTSEC-0000-0000"
package = "gitsync"
date = "2023-01-20"
url = "https://github.com/rawkode/gitsync/issues/1"
cvss = "CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N"
keywords = ["ssh", "mitm"]
[affected]
functions = { "gitsync::gitsync::GitSync::bootstrap" = ["<= 0.1.8"] }
[versions]
patched = []
```

# MITM attack possible due to missing host-key verification

This crate doesn't verify the host-id of the git server that it interacts with, and is thus vulnerable to MITM attacks.

The attacker can fully control the content of the repository that is cloned with the bootstrap method.

Reproduction:

```rust
fn main() {
    let gs = gitsync::GitSync {
	repo: "capitol@github.com:/tmp/gs-repo/".to_string(),
        dir: std::path::PathBuf::from("/tmp/out"),
        branch: None,
        username: Some("capitol".to_string()),
        passphrase: None,
        private_key: Some("/home/capitol/.ssh/id_rsa".to_string()),
    };

    println!("{:?}", gs.bootstrap());
}
```

```
[capitol@batia gitsync-reproduce]$ cat /etc/hosts
127.0.0.1 localhost
127.0.0.1 github.com
[capitol@batia gitsync-reproduce]$ rm -Rf /tmp/out/ && cargo run
    Finished dev [unoptimized + debuginfo] target(s) in 0.05s
     Running `target/debug/gitsync-reproduce`
Ok(())
[capitol@batia gitsync-reproduce]$ cd /tmp/out/
[capitol@batia out]$ git status
On branch main

No commits yet

nothing to commit (create/copy files and use "git add" to track)
```

As can be seen by the above output a empty repository that I had created in /tmp/gs-repo was cloned into /tmp/out without any error messages about an MITM attack on github.com.