```toml
[advisory]
id = "RUSTSEC-0000-0000"
package = "rust-i18n"
date = "2024-01-19"
url = "https://github.com/longbridgeapp/rust-i18n/issues/71"
informational = "unsound"
categories = ["memory-exposure"]

[affected]
functions = { "rust_i18n::set_locale" = [">= 3.0.0"] }

[versions]
patched = []
unaffected = ["< 3.0.0"]
```

# Use-after-free when setting the locale

Version 3.0.0 introduced an `AtomicStr` type, that is used to store the current locale.
It stores the locale as a raw pointer to an `Arc<String>`.
The locale can be read with `AtomicStr::as_str()`.
`AtomicStr::as_str()` does not increment the usage counter of the `Arc`.

If the locale is changed in one thread, another thread can have a stale -- possibly already freed --
reference to the stored string.
